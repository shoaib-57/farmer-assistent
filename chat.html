<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Farmer Assistant - Chat</title>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg: #1e1f22;
            --panel: #2c2f36;
            --border: #444;
            --muted: #aaa;
            --text: #fff;
            --primary: #4CAF50;
            --ring: #ffeb3b;
        }

        :root {
            color-scheme: dark
        }

        * {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            display: flex;
            min-height: 100vh
        }

        /* Skip link */
        .skip-link {
            position: absolute;
            left: -999px;
            top: auto
        }

        .skip-link:focus {
            left: 12px;
            top: 12px;
            background: var(--ring);
            color: #000;
            padding: .5rem .75rem;
            border-radius: .5rem;
            z-index: 1000
        }

        /* Focus ring */
        :focus-visible {
            outline: 3px solid var(--ring);
            outline-offset: 2px;
            border-radius: 8px
        }

        /* Sidebar */
        nav.sidebar {
            width: 200px;
            background: var(--panel);
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border)
        }

        .sidebar h2 {
            margin-bottom: 20px;
            font-size: clamp(1rem, .95rem + .3vw, 1.125rem)
        }

        .sidebar a,
        .login-btn {
            text-decoration: none;
            color: #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            gap: 7px;
            line-height: 1
        }

        .sidebar a:hover {
            background: #3a3f47
        }

        .login-btn {
            background: var(--primary);
            color: #fff;
            font-weight: 700;
            transition: .3s;
            margin-top: auto;
            justify-content: center
        }

        .login-btn:hover {
            background: #45a049
        }

        .sidebar svg {
            width: 18px;
            height: 18px;
            flex: 0 0 18px
        }

        /* Chat container */
        main.chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between
        }

        /* Messages */
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            scrollbar-width: thin;
            scrollbar-color: #555 transparent
        }

        .chat-messages::-webkit-scrollbar {
            width: 10px
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 10px
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent
        }

        .message {
            margin: 10px 0;
            max-width: 60%;
            padding: 12px 16px;
            border-radius: 1.5rem;
            line-height: 1.5;
            font-size: clamp(.95rem, .9rem + .2vw, 1rem)
        }

        .user-message {
            background: var(--primary);
            align-self: flex-end
        }

        .bot-message {
            background: #3a3f47;
            align-self: flex-start
        }

        /* Input bar */
        .chat-input {
            display: grid;
            grid-template-columns: 1fr;
            padding: 20px;
            border-top: 1px solid var(--border)
        }

        .input-wrapper {
            justify-self: center;
            display: flex;
            align-items: center;
            background: var(--panel);
            border: 1px solid #555;
            border-radius: 40px;
            padding: 6px 12px;
            width: min(750px, 100%)
        }

        .input-wrapper input {
            flex: 1;
            padding: 14px 18px;
            border: none;
            outline: none;
            background: transparent;
            color: #fff;
            font-size: 15px;
            min-height: 44px
        }

        .input-wrapper input::placeholder {
            color: var(--muted)
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
            min-height: 44px;
            /* touch target */
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, .1)
        }

        .icon-btn svg {
            width: 22px;
            height: 22px
        }

        /* Clear focus ring for keyboard users */
        :focus-visible {
            outline: 3px solid #ffeb3b;
            outline-offset: 2px;
            border-radius: 8px;
        }

        /* ===== Dark-mode fix for cards (Option A) ===== */
        .feature-box,
        .how-it-works .step {
            background: #e8f5e9;
            color: #0f1a0f;
            /* readable text in light mode */
        }

        .feature-box h3 {
            color: #388e3c;
        }

        /* Dark mode: darker cards + light text */
        @media (prefers-color-scheme: dark) {

            .features h2,
            .how-it-works h2 {
                color: #9be29f;
            }

            .feature-box,
            .how-it-works .step {
                background: #1b1c20;
                color: #e6e6e6;
                box-shadow: none;
            }

            .feature-box h3 {
                color: #9be29f;
            }
        }




        /* Responsive */
        @media (max-width:768px) {
            nav.sidebar {
                display: none
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: .01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: .01ms !important
            }
        }
    </style>
</head>

<body>

    <a class="skip-link" href="#main">Skip to chat</a>

    <!-- Sidebar -->
    <nav class="sidebar" aria-label="Sidebar navigation">
        <h2>AI Farmer Assistant</h2>

        <a href="index.html" aria-label="Go to Home">
            <!-- Home icon -->
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 3l9 7h-3v11H6V10H3l9-7z" />
            </svg>
            Home
        </a>

        <a href="#" id="newChat">
            <!-- Chat bubbles icon -->
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="18" height="18">
                <path
                    d="M12 3C7.03 3 3 6.58 3 11c0 1.84.78 3.55 2.05 4.9L4 21l5.41-1.81C10.17 19.73 11.07 20 12 20c4.97 0 9-3.58 9-8s-4.03-9-9-9zm0 14c-.73 0-1.45-.1-2.14-.3l-.43-.13-.4.13-2.34.78.48-2.15.12-.41-.3-.33C6.35 13.5 6 12.29 6 11c0-3.31 2.91-6 6-6s6 2.69 6 6-2.91 6-6 6z" />
            </svg>
            New Chat

        </a>

        <a href="#">
            <!-- Saved icon -->
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M6 4h12v16l-6-4-6 4z" />
            </svg>
            History
        </a>

        <a href="#">
            <!-- Settings icon -->
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                    d="M12 8a4 4 0 110 8 4 4 0 010-8zm8.94 3a7.96 7.96 0 00-.34-1l2-1.55-2-3.46-2.35.73a8.1 8.1 0 00-1.73-1l-.36-2.46H10.84l-.36 2.46c-.61.25-1.19.58-1.73 1L6.4 3.99 4.4 7.45l2 1.55c-.16.65-.27 1.32-.34 2.01l-2 .77.5 3.99 2.1.07c.33.57.72 1.1 1.16 1.59l-.66 2.01 3.46 2 1.55-2c.66.16 1.33.27 2.01.34l.77 2h3.99l.77-2c.68-.07 1.35-.18 2.01-.34l1.55 2 3.46-2-.66-2.01c.44-.49.83-1.02 1.16-1.59l2.1-.07.5-3.99-2-.77z" />
            </svg>
            Settings
        </a>


        <a href="loginPage.html" class="login-btn">Login</a>
    </nav>

    <!-- Chat Area -->
    <main class="chat-container" id="main">
        <div class="chat-messages" id="chatMessages" role="log" aria-live="polite" aria-label="Chat messages">
            <div class="message bot-message">Hello! How can I help you with your farming queries today?</div>
        </div>

        <!-- Input area -->
        <div class="chat-input">
            <div class="input-wrapper">
                <!-- Upload button -->
                <button class="icon-btn" id="uploadBtn" title="Upload file" aria-label="Upload file">
                    <!-- Paperclip -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path
                            d="M21.44 11.05l-8.49 8.49a6 6 0 1 1-8.49-8.49l9.19-9.19a4.5 4.5 0 1 1 6.36 6.36l-9.19 9.19a3 3 0 1 1-4.24-4.24l8.49-8.49" />
                    </svg>
                </button>

                <!-- Text input -->
                <input type="text" id="userInput" placeholder="Send a message..." aria-label="Your message" />

                <!-- Mic button -->
                <button class="icon-btn" id="micBtn" title="Voice input (coming soon)"
                    aria-label="Voice input (coming soon)">
                    <!-- Mic -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                        <path d="M19 10a7 7 0 0 1-14 0" />
                        <path d="M12 19v4" />
                    </svg>
                </button>

                <!-- Send button -->
                <button class="icon-btn" id="sendBtn" title="Send message" aria-label="Send message">
                    <!-- Paper plane -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M22 2L11 13" />
                        <path d="M22 2l-7 20-4-9-9-4 20-7z" />
                    </svg>
                </button>
            </div>
        </div>
    </main>

    <!-- Keep your existing JS (simple placeholder). No backend changes. -->
    <script>
        const sendBtn = document.getElementById('sendBtn');
const userInput = document.getElementById('userInput');
const chatMessages = document.getElementById('chatMessages');
const newChat = document.getElementById('newChat');
const uploadBtn = document.getElementById('uploadBtn');
const micBtn = document.getElementById('micBtn'); // may be null if not in HTML

function addMessage(content, type) {
  const msg = document.createElement('div');
  msg.classList.add('message', type === 'user' ? 'user-message' : 'bot-message');
  msg.textContent = content;
  chatMessages.appendChild(msg);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function botTyping() {
  const typing = document.createElement('div');
  typing.classList.add('message', 'bot-message');
  typing.textContent = "…";
  typing.dataset.typing = "true";
  chatMessages.appendChild(typing);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  return typing;
}
function removeTyping(el) { if (el && el.parentNode) el.parentNode.removeChild(el); }

async function handleSend() {
  const text = userInput.value.trim();
  if (!text) return;
  addMessage(text, 'user');
  userInput.value = '';

  const typingEl = botTyping();
  try {
    const res = await fetch("http://localhost:8000/api/answer", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        // add or remove the next line depending on whether you set API_KEY in the backend
        // "x-api-key": "demo123"
      },
      body: JSON.stringify({ message: text, user_id: 1 })
    });

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    removeTyping(typingEl);
    addMessage(data.answer || "Sorry, I didn’t get a response.", "bot");

    if (data.citations?.length) {
      const sources = data.citations.map(c => `• ${c.title}`).join("\n");
      addMessage("Sources:\n" + sources, "bot");
    }
  } catch (err) {
    console.error(err);
    removeTyping(typingEl);
    addMessage("⚠️ Couldn’t reach the server. Is it running on http://localhost:8000 ?",
               "bot");
  }
}

sendBtn.addEventListener('click', handleSend);
userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSend(); });
if (uploadBtn) uploadBtn.addEventListener('click', () => alert("Media upload coming soon!"));
if (micBtn) micBtn.addEventListener('click', () => alert("Voice input coming soon!"));
if (newChat) {
  newChat.addEventListener('click', (e) => {
    e.preventDefault();
    chatMessages.innerHTML = '<div class="message bot-message">New chat started. How can I help?</div>';
    userInput.value = '';
  });
}
        
    </script>

</body>

</html>